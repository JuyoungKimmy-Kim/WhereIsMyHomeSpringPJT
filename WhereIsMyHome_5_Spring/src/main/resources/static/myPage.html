<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
	<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
	
	<!-- JavaScript -->
	<script src="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/alertify.min.js"></script>
	
	<!-- CSS -->
	<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/alertify.min.css"/>
	<!-- Default theme -->
	<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/themes/default.min.css"/>
	<!-- Semantic UI theme -->
	<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/themes/semantic.min.css"/>
	<!-- Bootstrap theme -->
	<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/themes/bootstrap.min.css"/>

</head>
	<body>
	    <div class="container-fluid" style="width: 50%; padding-top: 10rem">
	       <div class="mb-3 mt-3 d-flex justify-content-center">
                 <h1>π‘©νμ›μ •λ³΄ μμ •β€β€π‘¦</h1>
            </div>
        <form class="row g-3">
            
            <div class="col-12">
              <label for="userName" class="form-label">μ΄λ¦„</label>
              <input type="text" class="form-control" id="userName">
               <div class="valid-feedback">μ°Έ μν–μ–΄μ”!</div>  
           	   <div class="invalid-feedback">μ΄λ¦„μ„ 3μ μ΄μƒ μ…λ ¥ν•μ„Έμ”.</div> 
            </div>
            
            <div class="col-md-6">
              <label for="userEmail" class="form-label">μ΄λ©”μΌ</label>
              <input type="email" class="form-control" id="userEmail">
              <div class="valid-feedback">κµΏ</div>  
              <div class="invalid-feedback">μ΄λ©”μΌμ„ ν™•μΈν•΄μ£Όμ„Έμ”.</div>  
            </div>
            
            <div class="col-md-6">
              <label for="userPassword" class="form-label">λΉ„λ°€λ²νΈ</label>
              <input type="password" class="form-control" id="userPassword">
			   <div class="valid-feedback">μΆ‹μ€ λΉ„λ°€λ²νΈλ„¤μ”!</div>  
          	   <div class="invalid-feedback">1κ° μ΄μƒ νΉμ λ¬Έμ, μλ¬Έ, μ«μλ¥Ό ν¬ν•¨ν•κ³  κΈΈμ΄λ” 8μ΄μƒμ΄μ–΄μ•Ό ν•©λ‹λ‹¤.</div>  
            </div>
            
            <div class="col-12">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="gridCheck">
                <label class="form-check-label" for="gridCheck">
                  μ•½κ΄€μ— λ™μν•©λ‹λ‹¤.
                </label>
              </div>
              
            </div>
         
            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
			  <button class="btn btn-primary "  type="submit" id="btnUpdate" >μμ •μ™„λ£</button>
			  <button class="btn btn-danger" type="submit" id="btnDelete" >νƒν‡΄</button>
			</div>
            
          </form>    
    </div>


 
    <script>
    window.onload = function() {
			
       
       	document.querySelector("#btnUpdate").onclick = function(e) {
       		e.preventDefault();
			if(validateUpdate()){
				userUpdate();
			}else{
				alertify.error("μ…λ ¥μ„ ν™•μΈν•΄ μ£Όμ„Έμ”.");
			}
		}
       	
     	document.querySelector("#btnDelete").onclick = function(e) {
       		e.preventDefault();
			userDelete();
		
		}
       	
        	
         
          
     };
    
     function validateUpdate(){
         // return true / false
         let isUserNameUpdateValid = false;
         let isUserEmailUpdateValid = false;
         let isUserPasswordUpdateValid = false;

         let isUserNameUpdateValue= document.querySelector("#userName").value;
         if( isUserNameUpdateValue.length > 0 ){
        	 isUserNameUpdateValid = true;
         }

         let isUserEmailUpdateValue = document.querySelector("#userEmail").value;
         if( isUserEmailUpdateValue.length > 0 ){
        	 isUserEmailUpdateValid = true;
         }

         let isUserPasswordUpdateValue = document.querySelector("#userPassword").value;
         if( isUserPasswordUpdateValue.length > 0 ){
        	 isUserPasswordUpdateValid = true;
         }

         
         if( isUserNameUpdateValid && isUserEmailUpdateValid && isUserPasswordUpdateValid ){
             return true;
         }
         return false;

     }
     
     async function userUpdate() {
     	let userName = document.querySelector("#userName").value;
   		let userEmail = document.querySelector("#userEmail").value;
        let userPassword = document.querySelector("#userPassword").value;

         // parameter
         let urlParams = new URLSearchParams({
        	 userName: userName,	
        	 userEmail : userEmail,
        	 userPassword: userPassword
         });
         // fetch options
         let fetchOptions = {
             method: "POST",
             body: urlParams
         }
         
         let url = "/user/userUpdate";
				try{
				   let response = await fetch( url , fetchOptions );
	              let data = await response.json(); // json => javascript object <= JSON.parse()
	              if( data.result == "success" ){ 
	            	  alertify.success("νμ› μ •λ³΄κ°€ μμ •λμ—μµλ‹λ‹¤.")

	              }else if( data.result == "fail" ){
	                  alertify.error('νμ› μ •λ³΄ μμ • κ³Όμ •μ—μ„ μ¤λ¥κ°€ λ°μƒν–μµλ‹λ‹¤.');
	              }
				} catch(error){
               alertify.error('νμ› μ •λ³΄ μμ • κ³Όμ •μ—μ„ μ¤λ¥κ°€ λ°μƒν–μµλ‹λ‹¤.');

				}
      
 	  }
     
     
     async function userDelete() {
     	 let userSeq = /* <%= userDto.getUserSeq() %> */;
         let url = "/user/userDelete";
         let urlParams = "?userSeq=" + userSeq;
         
			try{
			   let response = await fetch( url + urlParams );
           let data = await response.json(); // json => javascript object <= JSON.parse()
           if( data.result == "success" ){ // login.jsp => boardMain.jspλ΅ νμ΄μ§€ μ΄λ™ ( μƒλ΅μ΄ νμ΄μ§€(html....) μ”μ²­)
         	  alertify.success("νƒν‡΄ μ™„λ£λμ—μµλ‹λ‹¤.")
           }else if( data.result == "fail" ){
               alertify.error('νƒν‡΄ κ³Όμ •μ—μ„ μ¤λ¥κ°€ λ°μƒν–μµλ‹λ‹¤.');
           }
			} catch(error){
              alertify.error('νƒν‡΄ κ³Όμ •μ—μ„ μ¤λ¥κ°€ λ°μƒν–μµλ‹λ‹¤.');

			}
      
   	  }
	
     
     
     
    
    </script>
    

 
</body>
</html>